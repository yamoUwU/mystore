$((function(){var e,a=$(".review-list-container"),t=[],n=function(e){e.lightGallery({thumbnail:!0})},r=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e){var i=new URL(e,window.location.origin);Object.keys(r).forEach((function(e){r[e]&&i.searchParams.set(e,r[e])})),$.ajax({url:i.toString(),method:"GET",beforeSend:function(){a.append('<div class="loading-spinner"></div>')},success:function(e){var r=e.data,i=e.message;a.find("h4").text(i),a.find(".review-list").html(r),void 0!==Theme.lazyLoadInstance&&Theme.lazyLoadInstance.update(),n(a.find(".review-images")),t&&t()},complete:function(){a.find(".loading-spinner").remove()}})}},i=function(){return{search:$(".review-search-input").val()||"",sort_by:$(".review-sort-select").val()||"newest",star:$(".review-star-filter").val()||""}},o=function(){var e=""!==$(".review-search-input").val().trim(),a=""!==$(".review-star-filter").val(),t="newest"!==$(".review-sort-select").val();e||a||t?$(".review-clear-btn").removeClass("d-none"):$(".review-clear-btn").addClass("d-none")},s=function(e){for(var a=new ClipboardEvent("").clipboardData||new DataTransfer,n=0,r=t;n<r.length;n++){var i=r[n];a.items.add(i)}e.files=a.files,function(e){var a=$(".image-upload__text"),t=$(e).data("max-files"),n=e.files.length;t?(n>=t?a.closest(".image-upload__uploader-container").addClass("d-none"):a.closest(".image-upload__uploader-container").removeClass("d-none"),a.text(n+"/"+t)):a.text(n);var r=$(".image-viewer__list"),i=$("#review-image-template").html();if(r.find(".image-viewer__item").remove(),n){for(var o=n-1;o>=0;o--)r.prepend(i.replace("__id__",o));for(var s=function(a){var t=new FileReader;t.onload=function(e){r.find(".image-viewer__item[data-id="+a+"]").find("img").attr("src",e.target.result)},t.readAsDataURL(e.files[a])},l=n-1;l>=0;l--)s(l)}}(e)};a.length&&(n($(".review-images")),r(a.data("ajax-url"),null,i())),a.on("click",".pagination a",(function(e){e.preventDefault();var t=$(e.currentTarget).prop("href");r(t,(function(){$("html, body").animate({scrollTop:a.offset().top-130})}),i())})),$(document).on("submit",".product-review-container form",(function(e){e.preventDefault(),e.stopPropagation();var n=$(e.currentTarget),o=n.find('button[type="submit"]');$.ajax({type:"POST",cache:!1,url:n.prop("action"),data:new FormData(n[0]),contentType:!1,processData:!1,beforeSend:function(){o.prop("disabled",!0).addClass("loading")},success:function(e){var o=e.error,s=e.message;o?Theme.showError(s):(n.find("select").val(0),n.find("textarea").val(""),n.find("input[type=file]").val(""),n.find("input.custom-field").val(""),t=[],Theme.showSuccess(s),r(a.data("ajax-url"),(function(){$(".review-list").length||setTimeout((function(){return window.location.reload()}),1e3)}),i()))},error:function(e){Theme.handleError(e,n)},complete:function(){o.prop("disabled",!1).removeClass("loading")}})})),$(document).on("change",".product-review-container form input[type=file]",(function(e){e.preventDefault();var a=this,n=$(a),r=n.data("max-size");Object.keys(a.files).map((function(e){if(r&&a.files[e].size/1024>r){var i=n.data("max-size-message").replace("__attribute__",a.files[e].name).replace("__max__",r);Theme.showError(i)}else t.push(a.files[e])}));var i=t.length,o=n.data("max-files");o&&i>o&&t.splice(i-o-1,i-o),s(a)})),$(document).on("click",".product-review-container form .image-viewer__icon-remove",(function(e){e.preventDefault();var a=$(e.currentTarget).closest(".image-viewer__item").data("id");t.splice(a,1);var n=$(".product-review-container form input[type=file]")[0];s(n)})),$(document).on("click",".delete-review-btn",(function(e){e.preventDefault();var t=$(this),n=t.data("review-id"),o=t.data("confirm-message");if(confirm(o)){var s="/review/delete/".concat(n);$.ajax({url:s,type:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},beforeSend:function(){t.prop("disabled",!0).addClass("loading")},success:function(e){var t=e.message;Theme.showSuccess(t),r(a.data("ajax-url"),(function(){$(".review-list .review-item").length||setTimeout((function(){return window.location.reload()}),1e3)}),i())},error:function(e){var a="An error occurred while deleting the review.";e.responseJSON&&e.responseJSON.message&&(a=e.responseJSON.message),Theme.showError(a)},complete:function(){t.prop("disabled",!1).removeClass("loading")}})}})),$(document).on("input",'[data-bb-toggle="review-search"]',(function(){clearTimeout(e),e=setTimeout((function(){o(),a.length&&r(a.data("ajax-url"),null,i())}),500)})),$(document).on("change",'[data-bb-toggle="review-sort"]',(function(){o(),a.length&&r(a.data("ajax-url"),null,i())})),$(document).on("change",'[data-bb-toggle="review-star-filter"]',(function(){o(),a.length&&r(a.data("ajax-url"),null,i())})),$(document).on("click",'[data-bb-toggle="review-star-filter-bar"]',(function(){var e=$(this).data("star");$(".review-star-filter").val(e),a.length&&r(a.data("ajax-url"),null,i())})),$(document).on("keydown",'[data-bb-toggle="review-star-filter-bar"]',(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),$(this).click())})),$(document).on("click",'[data-bb-toggle="review-search-toggle"]',(function(){var e=$(".review-search-container"),a=$(this);e.hasClass("d-none")?($(".review-filter-container, .review-sort-container").addClass("d-none"),$(".review-control-buttons .btn").removeClass("active"),e.removeClass("d-none"),a.addClass("active"),$(".review-search-input").focus()):(e.addClass("d-none"),a.removeClass("active")),o()})),$(document).on("click",'[data-bb-toggle="review-filter-toggle"]',(function(){var e=$(".review-filter-container"),a=$(this);e.hasClass("d-none")?($(".review-search-container, .review-sort-container").addClass("d-none"),$(".review-control-buttons .btn").removeClass("active"),e.removeClass("d-none"),a.addClass("active")):(e.addClass("d-none"),a.removeClass("active")),o()})),$(document).on("click",'[data-bb-toggle="review-sort-toggle"]',(function(){var e=$(".review-sort-container"),a=$(this);e.hasClass("d-none")?($(".review-search-container, .review-filter-container").addClass("d-none"),$(".review-control-buttons .btn").removeClass("active"),e.removeClass("d-none"),a.addClass("active")):(e.addClass("d-none"),a.removeClass("active")),o()})),$(document).on("click",'[data-bb-toggle="review-clear-filters"]',(function(){$(".review-search-input").val(""),$(".review-star-filter").val(""),$(".review-sort-select").val("newest"),$(".review-search-container, .review-filter-container, .review-sort-container").addClass("d-none"),$(".review-control-buttons .btn").removeClass("active"),o(),a.length&&r(a.data("ajax-url"),null,i())})),sessionStorage.reloadReviewsTab&&($('#product-detail-tabs a[href="#product-reviews"]').length&&new bootstrap.Tab($('#product-detail-tabs a[href="#product-reviews"]')[0]).show(),sessionStorage.reloadReviewsTab=!1)}));